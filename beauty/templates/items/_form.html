<!-- Form Section -->
<div class="row gx-4 gx-lg-5">
    <div class="col-lg-8 mx-auto">
        <div class="card border-0 rounded-3 shadow-sm">
            <div class="card-header bg-light border-0 py-3">
                <h5 class="card-title mb-0 text-primary">
                    <i class="fas fa-edit me-2"></i>アイテム情報
                </h5>
            </div>
            <div class="card-body p-4">
                <form method="post" id="item-form" enctype="multipart/form-data" class="needs-validation" novalidate>
                    {% csrf_token %}

                    <!-- Image Upload -->
                    <div class="mb-4">
                        <label for="{{ form.image.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-camera me-2 text-primary"></i>{{ form.image.label }}
                        </label>
                        {{ form.image }}
                        {% if form.image.help_text %}
                        <div class="form-text">{{ form.image.help_text }}</div>
                        {% endif %}
                        {% if form.image.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.image.errors %}
                            {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <!-- Image Preview -->
                        <div id="image-preview" class="mt-3" {% if not item.image %}style="display: none;" {% endif %}>
                            <img id="preview-img" src="{% if item.image %}{{ item.image.url }}{% else %}#{% endif %}"
                                alt="プレビュー" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                        </div>
                    </div>

                    <!-- Product Information Row -->
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <label for="{{ form.name.id_for_label }}" class="form-label fw-semibold required">
                                <i class="fas fa-cube me-2 text-primary"></i>{{ form.name.label }}
                            </label>
                            {{ form.name }}
                            {% if form.name.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.name.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Brand and Color Row -->
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="{{ form.brand.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-star me-2 text-primary"></i>{{ form.brand.label }}
                                </label>
                                {{ form.brand }}
                                {% if form.brand.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.brand.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="{{ form.color_code.id_for_label }}" class="form-label fw-semibold">
                                    <i class="fas fa-palette me-2 text-primary"></i>{{ form.color_code.label }}
                                </label>
                                {{ form.color_code }}
                                {% if form.color_code.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.color_code.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Category Selection -->
                        <div id="ai-suggest" class="mt-2" data-api-url="{% url 'beauty:suggest_category_api' %}">
                            <button type="button" id="btn-suggest" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-magic me-1"></i> AIでカテゴリ候補を取得
                            </button>
                            <small class="text-muted d-block mt-1">
                                商品名／ブランドをもとに最も細かいカテゴリ候補を提案します
                            </small>
                            <ul id="suggest-list" class="list-unstyled mt-2"></ul>
                        </div>

                        <div class="mb-4">
                            <label for="{{ form.product_type.id_for_label }}" class="form-label fw-semibold required">
                                <i class="fas fa-tags me-2 text-primary"></i>{{ form.product_type.label }}
                            </label>
                            {{ form.product_type }}
                            {% if form.product_type.help_text %}
                            <div class="form-text">{{ form.product_type.help_text }}</div>
                            {% endif %}
                            {% if form.product_type.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.product_type.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Date Information Row -->
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="{{ form.opened_on.id_for_label }}" class="form-label fw-semibold required">
                                    <i class="fas fa-calendar-alt me-2 text-primary"></i>{{ form.opened_on.label }}
                                </label>
                                {{ form.opened_on }}
                                {% if form.opened_on.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.opened_on.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="{{ form.expires_on.id_for_label }}" class="form-label fw-semibold required">
                                    <i class="fas fa-clock me-2 text-primary"></i>{{ form.expires_on.label }}
                                </label>
                                {{ form.expires_on }}
                                {% if form.expires_on.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.expires_on.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Memo -->
                        <div class="mb-4">
                            <label for="{{ form.memo.id_for_label }}" class="form-label fw-semibold">
                                <i class="fas fa-sticky-note me-2 text-primary"></i>{{ form.memo.label }}
                            </label>
                            {{ form.memo }}
                            {% if form.memo.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.memo.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Form-level errors -->
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                            {{ error }}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Buttons -->
                        <div class="d-flex justify-content-center gap-5 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg px-4">
                                <i class="fas fa-save me-2"></i>保存
                            </button>
                            {% if item %}
                            <a href="{% url 'beauty:item_detail' id=item.id %}"
                                class="btn btn-outline-secondary btn-lg px-4">
                                <i class="fas fa-times me-2"></i>キャンセル
                            </a>
                            {% else %}
                            <a href="{% url 'beauty:home' %}" class="btn btn-outline-secondary btn-lg px-4">
                                <i class="fas fa-times me-2"></i>キャンセル
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>